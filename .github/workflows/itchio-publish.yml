# Nombre del flujo de trabajo
name: Publish to Itch.io

# Cuándo se debe ejecutar
on:
  # Ejecutar cada vez que haces push a la rama 'master' o 'main'
  push:
    branches: ["master", "main"]

# Los trabajos (tareas) a realizar
jobs:
  deploy:
    # Usar la última versión de Ubuntu para ejecutar el trabajo
    runs-on: ubuntu-latest

    steps:
      # 1. Descarga tu código del repositorio
      - name: Checkout source code
        uses: actions/checkout@v3

      # 2. Exporta el juego usando la acción de Godot
      - name: Godot Export
        id: export # Le damos un ID para usar sus resultados luego
        uses: firebelley/godot-export@v5.2.1
        with:
          # --- URLs para Godot 4.5 (como menciona el artículo) ---
          godot_executable_download_url: https://github.com/godotengine/godot/releases/download/4.5-stable/Godot_v4.5-stable_linux.x86_64.zip
          
          # NOTA: El artículo tenía un pequeño error de formato aquí.
          # Este es el parámetro correcto para las plantillas de exportación:
          godot_export_templates_download_url: https://github.com/godotengine/godot/releases/download/4.5-stable/Godot_v4.5-stable_export_templates.tpz

          # Ruta a la carpeta de tu proyecto (si está en la raíz, es ./)
          relative_project_path: ./
          
          # Comprime la salida en un .zip (¡perfecto para Itch.io!)
          archive_output: true
          
          # Guarda Godot en caché para ejecuciones más rápidas
          cache: true
        env:
          # Pasamos el token de GitHub que guardamos en los secretos
          GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}

      # 3. Sube el juego a Itch.io usando la acción de Butler
      - name: Publish to Itch
        uses: Ayowel/butler-to-itch@v1.0.0
        with:
          # Pasamos la clave API de Itch.io que guardamos
          butler_key: ${{ secrets.ITCHIO_TOKEN }}
          
          # --- ¡IMPORTANTE! Edita estas líneas ---
          
          # Tu nombre de usuario de Itch.io
          # OJO: Como dice el artículo, ¡revisa la URL de tu perfil!
          # Si tu usuario es "mi_juego", la URL podría ser "mi-juego.itch.io"
          # Usa el nombre de la URL (ej. "mi-juego")
          itch_user: tu-usuario-itch
          
          # El nombre de tu juego en Itch.io (de la URL)
          # ej: "https://tu-usuario-itch.itch.io/mi-juego-genial"
          itch_game: mi-juego-genial
          
          # La versión (usa el nombre de la rama, ej: "master")
          version: ${{ github.ref_name }}
          
          # La ruta al archivo .zip que se creó en el paso 2
          # Reemplaza "nombre-del-preset.zip" con el nombre que le diste
          # a tu preset en Godot (ej: "mi-juego-web.zip")
          files: "${{ steps.export.outputs.archive_directory }}/mi-juego-web.zip"